#!/bin/bash
#PBS -N "tutorial-1-campus-cluster"
#PBS -W group_list=tallis
#PBS -q secondary
#PBS -l nodes=1:ppn=12
#PBS -l walltime=01:00:00
#PBS -j oe
#PBS -M [YourNetID]@illinois.edu
#PBS -m be

cd $PBS_O_WORKDIR

cur="/projects/tallis/aditikg2/reu2019-tutorials/1-campus-cluster/aditikg2" # This line is not very ideal
data="$cur/../../data"
tools="$cur/../../tools"

for ((i=1;i<=3;i++)) # Loop through the 3 model conditions
do
    for ((j=0;j<5;j++)) # Loop through the 5 replicate datasets
    do
	sp_dir="100M$i/R$j"
	dir="$data/$sp_dir"
	raw_in="$dir/rose.aln.true.fasta"
	
	mkdir -p $cur/inputs/$sp_dir # Make a inputs directory to store converted inputs
	in=$cur/inputs/$sp_dir/rose.aln.true.phy
	
	python3 $tools/seqtools.py -f p -i $raw_in -o $in # Run seqtools.py to convert input into desirable format

	# Run FASTME for the following four combinations

	pp_bionj=$cur/outputs/pp_bionj/$sp_dir # p-distances,BioNJ
	pp_nj=$cur/outputs/pp_nj/$sp_dir # p-distances,NJ
	pF_bionj=$cur/outputs/pF_bionj/$sp_dir 
	pF_nj=$cur/outputs/pF_nj/$sp_dir
	
	mkdir -p $pp_bionj
	#touch $pp_bionj/rose.tt
	fastme-2.1.5-linux64-omp -i $in -dp -o $pp_bionj/rose.tt
	
	mkdir -p $pp_nj
	#touch $pp_nj/rose.tt
	fastme-2.1.5-linux64-omp -i $in -dp -m N -o $pp_nj/rose.tt
	
	mkdir -p $pF_bionj
	#touch $pF_bionj/rose.tt
	fastme-2.1.5-linux64-omp -i $in -dK -o $pF_bionj/rose.tt
	
	mkdir -p $pF_nj
	#touch $pF_nj/rose.tt
	fastme-2.1.5-linux64-omp -i $in -dK -m N -o $pF_nj/rose.tt
    done
done
